<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDFC Season 3</title>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;600;700&family=Rajdhani:wght@500;600;700;800&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #FFD700; --blue: #00F0FF; --red: #FF3333; --dark: #050505; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: #000; color: white; font-family: 'Rajdhani', sans-serif;
            margin: 0; min-height: 100vh; overflow-x: hidden;
        }

        .bg-fixed {
            position: fixed; inset: 0;
            background: url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2560') center/cover no-repeat;
            z-index: -2;
        }
        .overlay {
            position: fixed; inset: 0;
            background: radial-gradient(circle at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.95) 90%);
            z-index: -1;
        }

        /* NAVIGATION */
        nav {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; gap: 10px; padding: 15px 20px;
            overflow-x: auto; white-space: nowrap; scrollbar-width: none;
        }
        nav::-webkit-scrollbar { display: none; }

        .nav-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); 
            color: #ccc; padding: 8px 20px; border-radius: 50px;
            font-family: 'Teko', sans-serif; font-size: 1.1rem; cursor: pointer;
            transition: 0.3s; text-transform: uppercase; flex-shrink: 0;
        }
        .nav-btn.active { 
            background: var(--gold); color: black; border-color: var(--gold); 
            font-weight: bold; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .page-section { display: none; padding: 100px 15px 40px 15px; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.5s ease; }
        .page-section.active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        #home { 
            height: 100vh; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; text-align: center; padding-top: 60px;
        }
        #home.active-page { display: flex; }

        .home-poster-img {
            width: 100%; max-width: 350px; height: auto;
            border-radius: 15px; border: 2px solid var(--gold);
            box-shadow: 0 0 40px rgba(0, 240, 255, 0.3); margin-bottom: 25px;
            object-fit: cover;
        }

        .cta-btn { 
            background: var(--blue); color: black; border: none; padding: 15px 60px; 
            font-family: 'Teko'; font-size: 2rem; cursor: pointer; border-radius: 50px; 
            box-shadow: 0 0 20px rgba(0,240,255,0.4); transition: 0.3s; font-weight: bold;
        }

        .content-container {
            background: rgba(10, 10, 15, 0.95); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        h1.page-title { text-align: center; font-family: 'Teko'; font-size: 4rem; margin: 0 0 20px 0; color: white; text-shadow: 0 0 10px var(--blue); }

        /* STANDINGS UI */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .card { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; overflow: hidden; }
        .card h3 { background: #222; color: var(--gold); margin: 0; padding: 10px; font-family: 'Teko'; font-size: 1.5rem; }
        
        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 350px; }
        th { background: #111; color: #888; font-size: 0.8rem; padding: 8px; text-transform: uppercase; }
        td { padding: 10px 5px; border-bottom: 1px solid #2a2a2a; text-align: center; }
        td:first-child { text-align: left; padding-left: 10px; font-weight: bold; width: 35%; }
        
        /* PLAYER IMAGES (GLOBAL) */
        .p-info { display: flex; align-items: center; gap: 8px; }
        .p-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid var(--gold); background: #222; }
        .pts { color: var(--blue); font-weight: bold; background: rgba(0,240,255,0.1); }
        .gd { color: #ccc; font-size: 0.8rem; }

        /* --- GROUP MATCHES UI (PC & MOBILE) --- */
        .match-card {
            background: #111; padding: 15px; margin-bottom: 12px;
            border-radius: 12px; border-left: 4px solid var(--blue);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .m-head { display: flex; justify-content: space-between; font-size: 0.8rem; color: #666; margin-bottom: 10px; text-transform: uppercase; }
        
        .m-body { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        
        .m-team { display: flex; align-items: center; gap: 10px; width: 42%; font-weight: bold; font-size: 1rem; }
        .m-team.right { justify-content: flex-end; text-align: right; }
        .m-score { font-family: 'Teko'; font-size: 2.5rem; color: var(--gold); min-width: 60px; text-align: center; }
        .vs-badge { font-family: 'Teko'; font-size: 1.5rem; color: #333; border: 1px solid #222; padding: 0 10px; border-radius: 4px; }

        /* MOBILE FIX: Name below Photo */
        @media (max-width: 600px) {
            .m-body { gap: 5px; }
            .m-team { 
                flex-direction: column; /* Stack vertically */
                text-align: center; 
                width: 33%; 
                font-size: 0.8rem; 
                gap: 5px; 
            }
            .m-team.right { flex-direction: column; text-align: center; justify-content: center; }
            .m-team span { width: 100%; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
            
            .m-score { font-size: 1.8rem; min-width: 50px; }
            .p-img { width: 45px; height: 45px; }
        }

        /* BRACKET */
        .bracket-scroll { display: flex; gap: 20px; overflow-x: auto; padding: 20px 0; }
        .round-column { min-width: 85vw; display: flex; flex-direction: column; gap: 15px; }
        @media (min-width: 768px) { .round-column { min-width: 350px; } }
        .round-header { text-align: center; color: var(--gold); font-family: 'Teko'; font-size: 2rem; background: rgba(0,0,0,0.5); border-radius: 5px; margin-bottom: 10px; }

        .b-card { background: linear-gradient(145deg, #1a1a20, #0a0a0f); border: 1px solid #333; border-radius: 12px; padding: 15px; }
        .b-team { display: flex; justify-content: space-between; margin-bottom: 5px; align-items: center; }
        .b-score { color: var(--gold); font-weight: bold; font-family: 'Teko'; font-size: 1.5rem; }
        .b-team.winner .b-score { color: #00E676; }

        #loader { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
    </style>
</head>
<body>

<div id="loader"><h1 style="color:var(--gold); font-family:'Teko'; font-size:3rem;">LOADING...</h1></div>

<div class="bg-fixed"></div><div class="overlay"></div>

<nav>
    <button class="nav-btn active" id="btn-home" onclick="showPage('home')">Home</button>
    <button class="nav-btn" id="btn-qual" onclick="showPage('qual')">Qualifiers</button>
    <button class="nav-btn" id="btn-groups" onclick="showPage('groups')">Groups</button>
    <button class="nav-btn" id="btn-matches" onclick="showPage('matches')">Matches</button>
    <button class="nav-btn" id="btn-bracket" onclick="showPage('bracket')">Knockout</button>
    <button class="nav-btn" onclick="window.location.href='player.html'">Player info</button>
    <button class="nav-btn" onclick="window.location.href='help.html'">Help</button>
</nav>

<!-- HOME -->
<div id="home" class="page-section active-page">
    <h1 style="font-family:'Teko'; font-size:3rem; margin:0 0 20px 0; color:white; text-shadow:0 0 10px var(--blue);">KDFC CHAMPIONSHIP</h1>
    <img src="1.jpg" class="home-poster-img" alt="Tournament Poster">
    <button onclick="window.location.href='reg.html'" class="cta-btn">REGISTER NOW</button>
    <button onclick="window.location.href='r.html'" style="background:#ff4d4d;color:#fff;border:none;padding:10px 20px;border-radius:50px;cursor:pointer;margin-top:10px;">Rules and Regulation</button>
</div>

<!-- QUALIFIERS -->
<div id="qual" class="page-section">
    <div class="content-container">
        <h1 class="page-title" style="color:var(--red)">PRE-QUALIFIERS</h1>
        <div id="ui-qual"><center>No Matches Yet</center></div>
    </div>
</div>

<!-- GROUPS -->
<div id="groups" class="page-section">
    <div class="content-container">
        <h1 class="page-title">STANDINGS</h1>
        <div id="ui-groups" class="grid"><center>Loading...</center></div>
    </div>
</div>

<!-- MATCHES -->
<div id="matches" class="page-section">
    <div class="content-container">
        <h1 class="page-title">GROUP MATCHES</h1>
        <div id="ui-matches" style="max-width:800px; margin:0 auto;"><center>No Matches Generated</center></div>
    </div>
</div>

<!-- KNOCKOUT -->
<div id="bracket" class="page-section">
    <div class="content-container" style="background:transparent; border:none; padding:0; box-shadow:none;">
        <h1 class="page-title">PLAYOFFS</h1>
        <div id="ui-bracket" class="bracket-scroll"><center>Bracket Not Started</center></div>
    </div>
</div>

<script>
    function showPage(id) {
        document.querySelectorAll('.page-section').forEach(el => { el.classList.remove('active-page'); el.style.display = 'none'; });
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        const target = document.getElementById(id);
        if(target) { target.style.display = (id==='home')?'flex':'block'; setTimeout(()=>target.classList.add('active-page'),10); }
        document.getElementById('btn-'+id).classList.add('active');
        window.scrollTo(0,0);
    }

    const firebaseConfig = {
        apiKey: "AIzaSyBIrBWQ4g_Bslww6XwmsZWv9OlHEsjRweE",
        authDomain: "wr-chat-d59f0.firebaseapp.com",
        databaseURL: "https://wr-chat-d59f0-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "wr-chat-d59f0",
        storageBucket: "wr-chat-d59f0.appspot.com",
        messagingSenderId: "256624682348",
        appId: "1:256624682348:web:24d5c6406ae87266bbff49",
        measurementId: "G-LDTY5VQJ45"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const DEF = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
    let globalData = null;

    db.ref().on('value', snap => {
        document.getElementById('loader').style.display='none';
        const d = snap.val();
        if(d) {
            globalData = d;
            renderQ(d.qualifiers);
            renderG(d.groups);
            renderM(d.matches);
            renderB(d.bracket);
        }
    });

    function getPhoto(name) {
        if(!globalData || !globalData.groups) return DEF;
        for(let key in globalData.groups) {
            let found = globalData.groups[key].find(p => p.name === name);
            if(found && found.photo) return found.photo;
        }
        return DEF;
    }

    function renderQ(q) {
        const ui = document.getElementById('ui-qual'); ui.innerHTML='';
        if(!q) return ui.innerHTML="<center>No Matches Yet</center>";
        q.forEach(m => {
            ui.innerHTML += `<div class="match-card" style="border-left:4px solid var(--red)">
                <div class="m-head">QUALIFIER â€¢ ${m.date||'TBD'}</div>
                <div class="m-body">
                    <div class="m-team">${m.p1}</div>
                    <div class="m-score">${m.s1} - ${m.s2}</div>
                    <div class="m-team right">${m.p2}</div>
                </div>
            </div>`;
        });
    }

    function renderG(g) {
        const ui = document.getElementById('ui-groups'); ui.innerHTML='';
        if(!g) return;
        Object.keys(g).forEach(k => {
            const s = [...g[k]].sort((a,b)=>b.pts-a.pts || b.gd-a.gd);
            let r = s.map(p=>`
            <tr>
                <td><div class="p-info"><img src="${p.photo||DEF}" class="p-img"> ${p.name}</div></td>
                <td>${p.p||0}</td><td>${p.w||0}</td><td>${p.d||0}</td><td>${p.l||0}</td><td class="gd">${p.gd||0}</td><td class="pts">${p.pts||0}</td>
            </tr>`).join('');
            ui.innerHTML += `<div class="card"><h3>GROUP ${k}</h3><div class="table-wrap"><table><tr><th>PLAYER</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GD</th><th>PTS</th></tr>${r}</table></div></div>`;
        });
    }

    function renderM(m) {
        const ui = document.getElementById('ui-matches'); ui.innerHTML='';
        if(!m) return ui.innerHTML="<center>No Matches Yet</center>";
        m.forEach(x => {
            ui.innerHTML += `
            <div class="match-card">
                <div class="m-head">
                    <span>GROUP ${x.group}</span>
                    <span>${x.date||'TBD'}</span>
                </div>
                <div class="m-body">
                    <!-- Name will appear BELOW photo on mobile due to flex-direction: column in CSS -->
                    <div class="m-team">
                        <img src="${getPhoto(x.p1)}" class="p-img">
                        <span>${x.p1}</span>
                    </div>
                    
                    <div>${x.played ? `<span class="m-score">${x.s1} - ${x.s2}</span>` : `<span class="vs-badge">VS</span>`}</div>
                    
                    <div class="m-team right">
                        <img src="${getPhoto(x.p2)}" class="p-img">
                        <span>${x.p2}</span>
                    </div>
                </div>
            </div>`;
        });
    }

    function renderB(b) {
        const ui = document.getElementById('ui-bracket'); ui.innerHTML='';
        if(!b || b.length === 0) return ui.innerHTML="<center>Bracket Not Started</center>";
        
        let roundsStructure = [];
        if(b.length === 3) roundsStructure = [ {n:"SEMIS", count:2}, {n:"FINAL", count:1} ];
        else if(b.length === 7) roundsStructure = [ {n:"QUARTERS", count:4}, {n:"SEMIS", count:2}, {n:"FINAL", count:1} ];
        else if(b.length === 15) roundsStructure = [ {n:"R16", count:8}, {n:"QUARTERS", count:4}, {n:"SEMIS", count:2}, {n:"FINAL", count:1} ];

        let idx = 0;
        roundsStructure.forEach(round => {
            let roundHTML = `<div class="round-column"><div class="round-header">${round.n}</div>`;
            for(let i=0; i<round.count; i++) {
                let m = b[idx++]; if(!m) break;
                let win1 = (m.s1 > m.s2) ? 'winner' : '';
                let win2 = (m.s2 > m.s1) ? 'winner' : '';
                roundHTML += `
                <div class="b-card">
                    <div class="b-team ${win1}"><div class="p-info"><img src="${m.p1_img||DEF}" class="p-img"> ${m.p1}</div><div class="b-score">${m.s1}</div></div>
                    <div class="b-team ${win2}"><div class="p-info"><img src="${m.p2_img||DEF}" class="p-img"> ${m.p2}</div><div class="b-score">${m.s2}</div></div>
                </div>`;
            }
            ui.innerHTML += roundHTML + `</div>`;
        });
    }
</script>
</body>
</html>
